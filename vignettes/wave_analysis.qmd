---
title: "Comprehensive Wave Analysis"
subtitle: "Irish Weather Buoy Network Data Analysis"
author: "irishbuoys package"
date: today
format:
  html:
    toc: true
    toc-depth: 3
    toc-location: left
    page-layout: full
    code-fold: true
    code-summary: "Show code"
    fig-width: 10
    fig-height: 6
execute:
  echo: true
  warning: false
  message: false
---

```{r setup}
#| include: false

# Load package - use pkgload for development, library for installed
if (requireNamespace("pkgload", quietly = TRUE) && file.exists("../DESCRIPTION")) {
  pkgload::load_all("..", quiet = TRUE)
} else {
  library(irishbuoys)
}

library(dplyr)
library(ggplot2)
library(knitr)

# Load pre-computed analysis data (or create placeholder if not available)
load_data <- function(file) {
  path <- system.file("extdata", file, package = "irishbuoys")
  if (path == "" || !file.exists(path)) {
    # Return placeholder data for development
    return(NULL)
  }
  readRDS(path)
}

analysis_summary <- load_data("wave_analysis_summary.rds")
rogue_events <- load_data("rogue_wave_events.rds")
return_levels <- load_data("return_levels.rds")
seasonal_data <- load_data("seasonal_analysis.rds")

# Flag for data availability
has_data <- !is.null(analysis_summary)

# Set ggplot theme
theme_set(theme_minimal(base_size = 12))
```

## Overview

This vignette provides a comprehensive analysis of wave and wind data from the Irish Weather Buoy Network. The analysis uses data from the [Marine Institute's ERDDAP server](https://erddap.marine.ie/erddap/tabledap/IWBNetwork.html).

**Data Summary:**

- **Total Observations:** `r format(analysis_summary$data_summary$n_observations, big.mark = ",")`
- **Stations:** `r paste(analysis_summary$data_summary$stations, collapse = ", ")`
- **Date Range:** `r format(analysis_summary$data_summary$date_range[1], "%Y-%m-%d")` to `r format(analysis_summary$data_summary$date_range[2], "%Y-%m-%d")`

---

## Wave Measurement Science {#wave-science}

Understanding how wave parameters are measured and calculated is essential for proper interpretation of the data.

### Glossary of Terms

```{r glossary}
glossary <- wave_glossary()
kable(glossary, caption = "Wave Measurement Terminology")
```

### Why Significant Wave Height (Hs) = 4 x Standard Deviation {#hs-formula}

The relationship **Hs = 4σ** comes from wave spectrum theory (Longuet-Higgins, 1952).

::: {.callout-important}
## Step-by-Step Calculation

1. **Measure** sea surface elevation η(t) over 17.5 minutes (raw data in meters)
2. **De-trend** by subtracting the mean: η'(t) = η(t) - mean(η)
   - This removes tidal/ambient sea level
   - Now we have pure wave-induced fluctuations
3. **Calculate σ** = standard deviation of the de-meaned elevations (units: meters)
4. **Hs = 4 × σ** (units: meters)

**Note:** We subtract the mean from the *raw data* (step 2), then calculate σ of the result (step 3). We do NOT subtract anything from σ itself.
:::

**Why multiply by 4?**

This is a **mathematical constant** from the Rayleigh distribution, not an arbitrary choice:

- For a narrow-banded Gaussian random sea, individual wave heights follow a **Rayleigh distribution**
- The theoretical average of the highest 1/3 of waves (H₁/₃) is derived by integrating the Rayleigh PDF:

$$H_{1/3} = \int_{H_{67\%}}^{\infty} H \cdot f(H) \, dH = 4.004\sigma \approx 4\sigma$$

**Physical meaning:** Hs approximates what trained observers visually estimate—they naturally focus on the larger, memorable waves, unconsciously averaging the highest third.

::: {.callout-note}
## Key References

1. **Longuet-Higgins, M.S. (1952)**. On the statistical distribution of the heights of sea waves. *J. Marine Research*, 11(3), 245-266. [Original derivation]

2. **Holthuijsen, L.H. (2007)**. *Waves in Oceanic and Coastal Waters*. Cambridge University Press. Chapter 4. [Modern textbook]

3. **WMO (2018)**. Guide to Wave Analysis and Forecasting. WMO-No. 702. [Operational standards]
:::

### Relationship Between Hs and RMS Wave Height

The **Root Mean Square (RMS)** wave height is related to energy content:

$$H_{rms} = \sqrt{\frac{1}{n}\sum_{i=1}^{n} H_i^2}$$

For a Rayleigh distribution:

$$H_{rms} = \frac{H_s}{\sqrt{8}} \approx 0.707 \times H_s$$

Or equivalently: **Hs ≈ 1.42 × H_rms**

### Why 17.5-Minute Measurement Period? {#measurement-period}

The Marine Institute buoys use **17.5-minute measurement periods**. Here's the rationale:

::: {.callout-tip}
## Statistical Requirement
The significant wave height (H₁/₃) requires a sufficient sample size for reliability. You need approximately **100-200 waves** for valid statistics.
:::

| Wave Type | Typical Period | Waves in 17.5 min |
|-----------|---------------|-------------------|
| Wind waves | 3-10 s | 105-350 |
| Swell | 10-25 s | 42-105 |
| Average ocean | ~8 s | ~130 |

**WMO Recommendations:**

- Standard period: **20-30 minutes**
- Minimum acceptable: **17 minutes**
- Marine Institute uses: **17.5 minutes** (lower bound)

**Trade-offs:**

| Longer Period | Shorter Period |
|---------------|----------------|
| ✓ Better statistics | ✓ Better temporal resolution |
| ✓ More stable Hs estimates | ✓ Captures rapid changes |
| ✗ Less temporal resolution | ✗ Higher uncertainty in Hs |

### How Hourly Data is Produced

The ERDDAP data provides **one value per hour**. Here's the process:

1. **Burst Sampling:** 17.5-minute measurement period
2. **Spectral Processing:** FFT applied to heave signal → wave spectrum
3. **Parameter Calculation:**
   - Hs = 4√m₀
   - Hmax from zero-crossing analysis
   - Tp from spectral peak
4. **Hourly Reporting:** Most recent burst analysis reported

---

## Rogue Wave Analysis {#rogue-waves}

### Definition

::: {.callout-important}
## Rogue Wave Definition
A **rogue wave** (also called freak wave or abnormal wave) is defined as a wave where:

$$\frac{H_{max}}{H_s} > 2.0$$

Some standards use a stricter threshold of 2.2.
:::

Rogue waves are NOT:

- Tsunamis (which are seismic waves)
- Storm surges (which are meteorologically forced)
- Tidal waves

They are **extreme individual waves** within a given sea state that significantly exceed the expected statistical distribution.

**Physical Mechanisms:**

1. **Wave-current interaction:** Waves steepening against opposing currents
2. **Modulational instability:** Benjamin-Feir instability in nonlinear wave groups
3. **Superposition:** Constructive interference of wave components
4. **Focusing:** Wave refraction by bathymetry or currents

### Rogue Wave Events

```{r rogue-summary}
#| label: tbl-rogue-summary
#| tbl-cap: "Rogue Wave Detection Summary"

stats <- analysis_summary$rogue_waves$statistics

kable(stats$overall, caption = "Overall Rogue Wave Statistics")
```

**Events Detected:** `r nrow(rogue_events)` rogue wave events (Hmax/Hs > 2.0)

### Rogue Waves by Station

::: {.panel-tabset}

#### All Stations

```{r rogue-all}
#| fig-cap: "Rogue wave events across all stations"

if (nrow(rogue_events) > 0) {
  ggplot(rogue_events, aes(x = time, y = rogue_ratio, color = station_id)) +
    geom_point(alpha = 0.7, size = 2) +
    geom_hline(yintercept = 2.0, linetype = "dashed", color = "red") +
    geom_hline(yintercept = 2.2, linetype = "dotted", color = "darkred") +
    labs(
      x = "Time",
      y = "Hmax / Hs Ratio",
      color = "Station",
      title = "Rogue Wave Events (Ratio > 2.0)"
    ) +
    annotate("text", x = min(rogue_events$time), y = 2.05,
             label = "Standard threshold (2.0)", hjust = 0, color = "red") +
    annotate("text", x = min(rogue_events$time), y = 2.25,
             label = "Strict threshold (2.2)", hjust = 0, color = "darkred") +
    theme(legend.position = "bottom")
}
```

#### M2

```{r rogue-m2}
m2_rogues <- rogue_events[rogue_events$station_id == "M2", ]
if (nrow(m2_rogues) > 0) {
  ggplot(m2_rogues, aes(x = time, y = hmax)) +
    geom_point(aes(color = rogue_ratio), size = 3) +
    scale_color_viridis_c(name = "Hmax/Hs") +
    labs(x = "Time", y = "Maximum Wave Height (m)", title = "M2 Rogue Wave Events")
} else {
  cat("No rogue waves detected at M2")
}
```

#### M3

```{r rogue-m3}
m3_rogues <- rogue_events[rogue_events$station_id == "M3", ]
if (nrow(m3_rogues) > 0) {
  ggplot(m3_rogues, aes(x = time, y = hmax)) +
    geom_point(aes(color = rogue_ratio), size = 3) +
    scale_color_viridis_c(name = "Hmax/Hs") +
    labs(x = "Time", y = "Maximum Wave Height (m)", title = "M3 Rogue Wave Events")
} else {
  cat("No rogue waves detected at M3")
}
```

#### M4

```{r rogue-m4}
m4_rogues <- rogue_events[rogue_events$station_id == "M4", ]
if (nrow(m4_rogues) > 0) {
  ggplot(m4_rogues, aes(x = time, y = hmax)) +
    geom_point(aes(color = rogue_ratio), size = 3) +
    scale_color_viridis_c(name = "Hmax/Hs") +
    labs(x = "Time", y = "Maximum Wave Height (m)", title = "M4 Rogue Wave Events")
} else {
  cat("No rogue waves detected at M4")
}
```

#### M5

```{r rogue-m5}
m5_rogues <- rogue_events[rogue_events$station_id == "M5", ]
if (nrow(m5_rogues) > 0) {
  ggplot(m5_rogues, aes(x = time, y = hmax)) +
    geom_point(aes(color = rogue_ratio), size = 3) +
    scale_color_viridis_c(name = "Hmax/Hs") +
    labs(x = "Time", y = "Maximum Wave Height (m)", title = "M5 Rogue Wave Events")
} else {
  cat("No rogue waves detected at M5")
}
```

#### M6

```{r rogue-m6}
m6_rogues <- rogue_events[rogue_events$station_id == "M6", ]
if (nrow(m6_rogues) > 0) {
  ggplot(m6_rogues, aes(x = time, y = hmax)) +
    geom_point(aes(color = rogue_ratio), size = 3) +
    scale_color_viridis_c(name = "Hmax/Hs") +
    labs(x = "Time", y = "Maximum Wave Height (m)", title = "M6 Rogue Wave Events")
} else {
  cat("No rogue waves detected at M6")
}
```

:::

### Rogue Waves by Weather Conditions

::: {.panel-tabset}

#### Wind Speed

```{r rogue-wind}
if (nrow(rogue_events) > 0 && "wind_category" %in% names(rogue_events)) {
  wind_summary <- rogue_events %>%
    group_by(wind_category) %>%
    summarise(
      n = n(),
      mean_ratio = mean(rogue_ratio, na.rm = TRUE),
      max_hmax = max(hmax, na.rm = TRUE),
      .groups = "drop"
    )

  ggplot(wind_summary, aes(x = reorder(wind_category, n), y = n, fill = mean_ratio)) +
    geom_col() +
    coord_flip() +
    scale_fill_viridis_c(name = "Mean\nHmax/Hs") +
    labs(
      x = "Wind Condition",
      y = "Number of Rogue Wave Events",
      title = "Rogue Waves by Wind Speed Category"
    )
}
```

#### Water Depth

```{r rogue-depth}
if (nrow(rogue_events) > 0 && "depth_category" %in% names(rogue_events)) {
  depth_summary <- rogue_events %>%
    group_by(depth_category) %>%
    summarise(
      n = n(),
      mean_ratio = mean(rogue_ratio, na.rm = TRUE),
      max_hmax = max(hmax, na.rm = TRUE),
      .groups = "drop"
    )

  ggplot(depth_summary, aes(x = depth_category, y = n, fill = mean_ratio)) +
    geom_col() +
    scale_fill_viridis_c(name = "Mean\nHmax/Hs") +
    labs(
      x = "Water Depth Category",
      y = "Number of Rogue Wave Events",
      title = "Rogue Waves: Deep Water vs Shelf Edge"
    )
}
```

#### Time of Day

```{r rogue-time}
if (nrow(rogue_events) > 0 && "time_of_day" %in% names(rogue_events)) {
  time_summary <- rogue_events %>%
    group_by(time_of_day) %>%
    summarise(n = n(), .groups = "drop")

  ggplot(time_summary, aes(x = time_of_day, y = n)) +
    geom_col(fill = "steelblue") +
    labs(
      x = "Time of Day",
      y = "Number of Rogue Wave Events",
      title = "Rogue Wave Distribution by Time of Day"
    )
}
```

#### Season

```{r rogue-season}
if (nrow(rogue_events) > 0 && "season" %in% names(rogue_events)) {
  season_summary <- rogue_events %>%
    group_by(season) %>%
    summarise(
      n = n(),
      mean_hmax = mean(hmax, na.rm = TRUE),
      .groups = "drop"
    )

  # Order seasons
  season_summary$season <- factor(season_summary$season,
    levels = c("Winter", "Spring", "Summer", "Autumn"))

  ggplot(season_summary, aes(x = season, y = n, fill = mean_hmax)) +
    geom_col() +
    scale_fill_viridis_c(name = "Mean Hmax") +
    labs(
      x = "Season",
      y = "Number of Rogue Wave Events",
      title = "Seasonal Distribution of Rogue Waves"
    )
}
```

:::

---

## Trend Decomposition {#trends}

### Seasonal Patterns

::: {.panel-tabset}

#### Wave Height

```{r seasonal-wave}
#| fig-cap: "Monthly mean significant wave height"

if (!is.null(seasonal_data$wave$monthly)) {
  monthly_wave <- seasonal_data$wave$monthly
  monthly_wave$month_name <- factor(monthly_wave$month_name, levels = month.abb)

  ggplot(monthly_wave, aes(x = month_name, y = mean)) +
    geom_col(fill = "steelblue") +
    geom_errorbar(aes(ymin = mean - sd, ymax = mean + sd), width = 0.3) +
    labs(
      x = "Month",
      y = "Mean Significant Wave Height (m)",
      title = "Monthly Wave Height Pattern"
    )
}
```

```{r seasonal-wave-table}
if (!is.null(seasonal_data$wave$seasonal)) {
  kable(seasonal_data$wave$seasonal, digits = 2,
        caption = "Seasonal Wave Height Statistics")
}
```

#### Wind Speed

```{r seasonal-wind}
#| fig-cap: "Monthly mean wind speed"

if (!is.null(seasonal_data$wind$monthly)) {
  monthly_wind <- seasonal_data$wind$monthly
  monthly_wind$month_name <- factor(monthly_wind$month_name, levels = month.abb)

  ggplot(monthly_wind, aes(x = month_name, y = mean)) +
    geom_col(fill = "darkorange") +
    geom_errorbar(aes(ymin = mean - sd, ymax = mean + sd), width = 0.3) +
    labs(
      x = "Month",
      y = "Mean Wind Speed (m/s)",
      title = "Monthly Wind Speed Pattern"
    )
}
```

```{r seasonal-wind-table}
if (!is.null(seasonal_data$wind$seasonal)) {
  kable(seasonal_data$wind$seasonal, digits = 2,
        caption = "Seasonal Wind Speed Statistics")
}
```

#### STL Decomposition

```{r stl-plot}
#| fig-height: 8
#| fig-cap: "STL decomposition of M3 wave height"

if (!is.null(seasonal_data$stl) && !is.null(seasonal_data$stl$components)) {
  stl_df <- seasonal_data$stl$components

  # Reshape for faceted plot
  stl_long <- tidyr::pivot_longer(
    stl_df,
    cols = c(original, seasonal, trend, remainder),
    names_to = "component",
    values_to = "value"
  )
  stl_long$component <- factor(stl_long$component,
    levels = c("original", "trend", "seasonal", "remainder"))

  ggplot(stl_long, aes(x = time, y = value)) +
    geom_line(color = "steelblue", alpha = 0.7) +
    facet_wrap(~component, scales = "free_y", ncol = 1) +
    labs(x = "Time", y = "Wave Height (m)",
         title = "STL Decomposition of Wave Height") +
    theme(strip.text = element_text(face = "bold"))
}
```

:::

### Long-term Trends

```{r annual-trends}
#| fig-cap: "Annual mean wave height with trend"

if (!is.null(analysis_summary$trends$annual_wave$annual_stats)) {
  annual_wave <- analysis_summary$trends$annual_wave$annual_stats

  p <- ggplot(annual_wave, aes(x = year, y = mean)) +
    geom_point(size = 3) +
    geom_line(alpha = 0.5) +
    geom_errorbar(aes(ymin = mean - sd, ymax = mean + sd), width = 0.3, alpha = 0.5)

  # Add trend line if available
  if (!is.null(analysis_summary$trends$annual_wave$trend_model)) {
    p <- p + geom_smooth(method = "lm", se = TRUE, color = "red", alpha = 0.2)
  }

  p + labs(
    x = "Year",
    y = "Mean Significant Wave Height (m)",
    title = "Annual Wave Height Trend",
    subtitle = sprintf("Trend: %+.3f m/decade (p = %.3f)",
                      analysis_summary$trends$annual_wave$trend_per_decade,
                      analysis_summary$trends$annual_wave$p_value)
  )
}
```

---

## Extreme Value Analysis {#eva}

Extreme Value Analysis (EVA) is used to estimate the probability of rare, extreme events based on historical data.

### Methodology

Two main approaches:

1. **Block Maxima (GEV):** Fit Generalized Extreme Value distribution to annual maximum values
2. **Peaks Over Threshold (GPD):** Fit Generalized Pareto Distribution to exceedances over a high threshold

We use the **Block Maxima** approach with annual maximum values.

::: {.callout-note}
## GEV Distribution

The GEV distribution has three parameters:

- **Location (μ):** Central tendency of extremes
- **Scale (σ):** Spread of extremes
- **Shape (ξ):** Tail behavior
  - ξ > 0: Fréchet (heavy tail)
  - ξ = 0: Gumbel (exponential tail)
  - ξ < 0: Weibull (bounded tail)
:::

### Return Levels

A **return level** is the value expected to be exceeded on average once every T years. For example:

- **10-year return level:** Expected to be exceeded 10% of years
- **100-year return level:** Expected to be exceeded 1% of years

::: {.panel-tabset}

#### Wave Height

```{r return-levels-wave}
#| fig-cap: "Wave height return levels with 95% confidence intervals"

if (!is.null(return_levels$wave)) {
  rl_wave <- return_levels$wave

  ggplot(rl_wave, aes(x = return_period, y = return_level)) +
    geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.3, fill = "steelblue") +
    geom_line(color = "steelblue", size = 1.2) +
    geom_point(color = "steelblue", size = 3) +
    scale_x_log10() +
    labs(
      x = "Return Period (years)",
      y = "Significant Wave Height (m)",
      title = "Wave Height Return Levels"
    )
}
```

```{r return-levels-wave-table}
if (!is.null(return_levels$wave)) {
  kable(return_levels$wave, digits = 2,
        caption = "Wave Height Return Levels (Hs)",
        col.names = c("Return Period (years)", "Return Level (m)", "Lower 95% CI", "Upper 95% CI", "Variable"))
}
```

#### Maximum Wave (Hmax)

```{r return-levels-hmax}
if (!is.null(return_levels$hmax)) {
  rl_hmax <- return_levels$hmax

  ggplot(rl_hmax, aes(x = return_period, y = return_level)) +
    geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.3, fill = "darkred") +
    geom_line(color = "darkred", size = 1.2) +
    geom_point(color = "darkred", size = 3) +
    scale_x_log10() +
    labs(
      x = "Return Period (years)",
      y = "Maximum Wave Height (m)",
      title = "Maximum Wave Height (Hmax) Return Levels"
    )
}
```

```{r return-levels-hmax-table}
if (!is.null(return_levels$hmax)) {
  kable(return_levels$hmax, digits = 2,
        caption = "Maximum Wave Height Return Levels (Hmax)")
}
```

#### Wind Speed

```{r return-levels-wind}
if (!is.null(return_levels$wind)) {
  rl_wind <- return_levels$wind

  ggplot(rl_wind, aes(x = return_period, y = return_level)) +
    geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.3, fill = "darkorange") +
    geom_line(color = "darkorange", size = 1.2) +
    geom_point(color = "darkorange", size = 3) +
    scale_x_log10() +
    labs(
      x = "Return Period (years)",
      y = "Wind Speed (m/s)",
      title = "Wind Speed Return Levels"
    )
}
```

```{r return-levels-wind-table}
if (!is.null(return_levels$wind)) {
  kable(return_levels$wind, digits = 2,
        caption = "Wind Speed Return Levels")
}
```

:::

### Summary of Extreme Event Estimates

```{r extremes-summary}
#| tbl-cap: "Summary of Extreme Event Return Levels"

extremes_df <- data.frame(
  Variable = c(rep("Wave Height (Hs)", 3), rep("Max Wave (Hmax)", 3), rep("Wind Speed", 3)),
  Return_Period = rep(c(10, 50, 100), 3),
  stringsAsFactors = FALSE
)

if (!is.null(return_levels$wave) && !is.null(return_levels$hmax) && !is.null(return_levels$wind)) {
  extremes_df$Return_Level <- c(
    return_levels$wave$return_level,
    return_levels$hmax$return_level,
    return_levels$wind$return_level
  )
  extremes_df$Unit <- c(rep("m", 6), rep("m/s", 3))
  extremes_df$Lower_CI <- c(
    return_levels$wave$lower,
    return_levels$hmax$lower,
    return_levels$wind$lower
  )
  extremes_df$Upper_CI <- c(
    return_levels$wave$upper,
    return_levels$hmax$upper,
    return_levels$wind$upper
  )

  kable(extremes_df, digits = 1)
}
```

---

## Gust Factor Analysis: Is There a "Rogue Wind"? {#rogue-wind}

### Background

For waves, we define a "rogue wave" as one where **Hmax/Hs > 2.0**. Is there an equivalent concept for wind?

The **gust factor** is the ratio of peak gust to sustained wind speed:

$$\text{Gust Factor} = \frac{\text{Peak Gust}}{\text{Sustained Wind}}$$

Typical gust factors are around **1.3** (30% increase from sustained to gust).

### Analysis Results

```{r gust-analysis}
if (!is.null(analysis_summary$gust_analysis$summary)) {
  kable(analysis_summary$gust_analysis$summary, digits = 2,
        caption = "Gust Factor Statistics")
}
```

### Is There a "Rogue Gust" Equivalent?

If we apply the same logic as rogue waves (ratio > 2× typical), we would define a "rogue gust" as:

$$\text{Gust Factor} > 2 \times 1.3 = 2.6$$

```{r rogue-comparison}
if (!is.null(analysis_summary$rogue_comparison)) {
  kable(analysis_summary$rogue_comparison, digits = 3,
        caption = "Comparison: Rogue Waves vs 'Rogue Gusts'")
}
```

::: {.callout-important}
## Conclusion: No Standard "Rogue Wind" Definition

Unlike rogue waves, there is **no established "rogue wind" or "rogue gust" definition** in meteorology. This is because:

1. **Different physics:** Wind gusts are turbulent fluctuations, not individual wave-like phenomena
2. **Different statistics:** Wind follows different distributions than ocean waves
3. **Different time scales:** Gusts occur on seconds, wave measurements on minutes

The gust factor is already the standard metric for extreme wind variability, and values > 1.5 are considered "gusty" conditions.
:::

### Gust Factor by Wind Speed Category

```{r gust-by-category}
if (!is.null(analysis_summary$gust_analysis$by_category)) {
  gust_cat <- analysis_summary$gust_analysis$by_category

  ggplot(gust_cat, aes(x = wind_category, y = mean_gf)) +
    geom_col(fill = "darkorange") +
    geom_errorbar(aes(ymin = mean_gf - 0.1, ymax = p95_gf), width = 0.3) +
    geom_hline(yintercept = 1.3, linetype = "dashed", color = "red") +
    annotate("text", x = 1, y = 1.35, label = "Typical GF = 1.3", hjust = 0, color = "red") +
    labs(
      x = "Sustained Wind Speed (m/s)",
      y = "Gust Factor",
      title = "Gust Factor by Wind Speed Category",
      subtitle = "Bars show mean, error bars extend to 95th percentile"
    )
}
```

---

## Technical Appendix {#appendix}

### Pipeline Architecture

This analysis uses a `{targets}` pipeline for reproducibility. The pipeline:

1. Loads data from DuckDB
2. Detects rogue waves
3. Performs trend decomposition
4. Fits extreme value models
5. Saves results for vignette rendering

To reproduce the analysis:

```r
# In the package directory
targets::tar_make()
```

### Environment Information

This vignette was generated in a **Nix pure mode** environment for reproducibility.

```{r session-info}
sessionInfo()
```

### Data Sources

- [Marine Institute ERDDAP Server](https://erddap.marine.ie/erddap/tabledap/IWBNetwork.html)
- [Irish Weather Buoy Network](https://data.gov.ie/dataset/weather-buoy-network)

### References

1. **Significant Wave Height:** Longuet-Higgins, M.S. (1952). On the statistical distribution of the heights of sea waves. *J. Marine Research*, 11, 245-266.

2. **Rogue Waves:** Dysthe, K., Krogstad, H.E., & Müller, P. (2008). Oceanic rogue waves. *Annual Review of Fluid Mechanics*, 40, 287-310.

3. **Extreme Value Analysis:** Coles, S. (2001). *An Introduction to Statistical Modeling of Extreme Values*. Springer.

4. **WMO Wave Measurement:** WMO-No. 702 (2019). *Manual on Codes: International Codes*.
